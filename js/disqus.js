/*! DisqusJS v1.3.0 | Sukka (https://skk.moe) | https://disqusjs.skk.moe | MIT License */"use strict";function DisqusJS(U){!function(s,f,o,n,r){function t(){for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];return(t=Object.assign||function(e){for(var s=0,o=arguments.length;s<o;s++){var n=arguments[s];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,s)}var p=function(e){return f.getElementById(e)},g=function(e){var s=p("dsqjs-msg");s&&(s.innerHTML=e)},q="click",d="disqus_thread",h="dsqjs_sort",c='target="_blank" rel="external nofollow noopener noreferrer"',l='<footer><p class="dsqjs-footer">Powered by <a class="dsqjs-disqus-logo" href="https://disqus.com" '+c+'></a>&nbsp;&amp;&nbsp;<a href="https://disqusjs.skk.moe" target="_blank">DisqusJS</a></p></footer>',m=function(e,s){return'<header class="dsqjs-header" id="dsqjs-header"><nav class="dsqjs-nav dsqjs-clearfix"><ul><li class="dsqjs-nav-tab dsqjs-tab-active"><span>'+e+' Comments</span></li><li class="dsqjs-nav-tab">'+s+'</li></ul><div class="dsqjs-order"><input class="dsqjs-order-radio" id="dsqjs-order-desc" type="radio" name="comment-order" value="desc" checked="true"><label class="dsqjs-order-label" for="dsqjs-order-desc" title="按从新到旧">最新</label><input class="dsqjs-order-radio" id="dsqjs-order-asc" type="radio" name="comment-order" value="asc"><label class="dsqjs-order-label" for="dsqjs-order-asc" title="按从旧到新">最早</label><input class="dsqjs-order-radio" id="dsqjs-order-popular" type="radio" name="comment-order" value="popular"><label class="dsqjs-order-label" for="dsqjs-order-popular" title="按评分从高到低">最佳</label></div></nav></header>'},j=function(e,s,o){var n=e.avatarEl,t=e.createdAt;return'<div class="dsqjs-post-item dsqjs-clearfix"><div class="dsqjs-post-avatar">'+n+'</div><div class="dsqjs-post-body"><div class="dsqjs-post-header">'+s+'<span class="dsqjs-meta"><time>'+a(t)+'</time></span></div><div class="dsqjs-post-content">'+o+"</div></div></div>"},v='如需完整体验请针对 disq.us | disquscdn.com | disqus.com 启用代理并 <a id="dsqjs-reload-disqus" class="dsqjs-msg-btn">尝试完整 Disqus 模式</a> | <a id="dsqjs-force-disqus" class="dsqjs-msg-btn">强制完整 Disqus 模式</a>',b=function(e){return n(e,{method:"GET"}).then(function(e){return r.all([e.ok,e.status,e.json(),e.headers])}).then(function(e){var s=e[0],o=e[1],n=e[2],t=e[3];if(s)return{ok:s,status:o,data:n,headers:t};throw new Error}).catch(function(e){throw e})},E=function(e,s){try{o.setItem(e,s)}catch(e){}},a=function(e){function s(e){return e<10?"0"+e:e}return e=Date.parse(new Date(e)),(e=new Date(e+288e5)).getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+" "+s(e.getHours())+":"+s(e.getMinutes())};function e(){var e;s.DISQUS?s.DISQUS.reset({reload:!0,config:function(){this.page.identifier=C.config.identifier,this.page.url=C.config.url,this.page.title=C.config.title}}):(e=f.createElement("script"),p(d).innerHTML='<div id="dsqjs"><section><div id="dsqjs-msg">评论完整模式加载中... 如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理，或切换至 <a id="dsqjs-force-dsqjs" class="dsqjs-msg-btn">评论基础模式</a></div></section>'+l+"</div>",p("dsqjs-force-dsqjs").addEventListener(q,D),e.src="https://"+C.config.shortname+".disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(f.head||f.body).appendChild(e))}function y(){p(d).innerHTML='<div id="dsqjs"><section><div id="dsqjs-msg">正在检查 Disqus 能否访问...</div></section>'+l+"</div>";function e(t){return new r(function(e,s){var o=new Image,n=setTimeout(function(){o.onerror=o.onload=null,s()},3e3);o.onerror=function(){clearTimeout(n),s()},o.onload=function(){clearTimeout(n),e()},o.src="https://"+t+"/favicon.ico?"+ +new Date+"="+ +new Date})}return r.all([e("disqus.com"),e(C.config.shortname+".disqus.com")]).then(w,D)}function L(){p("dsqjs-reload-disqus").addEventListener(q,y),p("dsqjs-force-disqus").addEventListener(q,w)}function i(){g("评论基础模式加载中... "+v),L();var e=C.config.api+"3.0/threads/list.json?forum="+encodeURIComponent(C.config.shortname)+"&thread="+encodeURIComponent("ident:"+C.config.identifier)+"&api_key="+encodeURIComponent(M());b(e).then(function(e){var s=e.data;if(0===s.code&&1===s.response.length){console.log("list.json response length == 1");var o=s.response[0],n=o.id,t=o.title,r=o.isClosed,a=o.posts;C.page={id:n,title:t,isClosed:r,length:a,comment:[]},p(d).innerHTML='<div id="dsqjs"><div id="dsqjs-msg">评论基础模式加载中... '+v+"</div>"+m(a,C.config.siteName)+'<section class="dsqjs-post-container"><ul class="dsqjs-post-list" id="dsqjs-post-container"><p class="dsqjs-no-comment">评论列表加载中...</p></ul><a id="dsqjs-load-more" class="dsqjs-load-more dsqjs-hide">加载更多评论</a></section>'+l+"</div>",L(),p("dsqjs-order-"+C.sortType).setAttribute("checked","true"),i(),console.log("list.json end getComemnt")}else{if(0!==s.code||1===s.response.length)throw console.log("list.json before throw error"),new Error;g('当前 Thread 尚未创建。是否切换至 <a id="dsqjs-force-disqus" class="dsqjs-msg-btn">完整 Disqus 模式</a>？'),p("dsqjs-force-disqus").addEventListener(q,w),console.log("list.json response.length != 1")}}).catch(T);function s(e){function n(e){return{comment:e,author:e.author.name,isPrimary:!!C.config.admin&&e.author.username===C.config.admin,children:o(+e.id),hasMore:e.hasMore}}console.log("before parseCommentData");var s=[],t=[],o=function(s){if(0===t.length)return null;var o=[];return t.forEach(function(e){e.parent===s&&o.unshift(n(e))}),o.length?o:null};return e.forEach(function(e){(e.parent?t:s).push(e)}),console.log("before return from parseCommentData "),s.map(n)}var i=function o(e){void 0===e&&(e="");function n(){Array.from(r).forEach(function(e){return e.removeEventListener("change",d)}),t.removeEventListener(q,i),Array.from(a).forEach(function(e){return e.removeEventListener(q,y)})}var t=p("dsqjs-load-more"),r=f.getElementsByClassName("dsqjs-order-radio"),a=f.getElementsByClassName("dsqjs-has-more-btn"),i=function(){n(),o(C.page.next)},d=function(e){var s=e.target;C.sortType=s.getAttribute("value"),E(h,C.sortType),n(),C.page.comment=[],C.page.next="",p("dsqjs-post-container").innerHTML='<p class="dsqjs-no-comment">正在切换排序方式...</p>',t.classList.add("dsqjs-hide"),o()},s=""===e?"":"&cursor="+e;t.classList.add("dsqjs-disabled");function c(e){var s=e.createdAt;return Date.parse(new Date(s))}function l(e,s){return e.parent&&s.parent?c(e)-c(s):0}var m=C.config.api+"3.0/threads/listPostsThreaded?forum="+encodeURIComponent(C.config.shortname)+"&thread="+encodeURIComponent(C.page.id)+encodeURIComponent(s)+"&api_key="+encodeURIComponent(M())+"&order="+encodeURIComponent(C.sortType);b(m).then(function(e){var s,o=e.data;if(0===o.code&&0<o.response.length){console.log("listPostsThreaded? response length > 0"),t.classList.remove("dsqjs-disabled"),console.log("before comment.push"),(s=C.page.comment).push.apply(s,o.response),console.log("before sort"),C.page.comment.sort(l),console.log("before render"),u(C.page.comment),console.log("before for each"),Array.from(r).forEach(function(e){return e.addEventListener("change",d)}),Array.from(a).forEach(function(e){return e.addEventListener(q,y)}),console.log("end for each"),o.cursor.hasNext?(C.page.next=o.cursor.next,t.innerHTML="加载更多评论",t.classList.remove("dsqjs-hide"),t.addEventListener(q,i)):t.classList.add("dsqjs-hide"),console.log("listPostsThreaded? end")}else{if(0!==o.code||0!==o.response.length)throw console.log("listPostsThreaded? before throw error"),new Error;console.log("listPostsThreaded? response length = 1"),g("你可能无法访问 Disqus，已启用评论基础模式。"+v),p("dsqjs-post-container").innerHTML='<p class="dsqjs-no-comment" >'+C.config.nocomment+"</p>",L(),p("dsqjs-force-disqus").addEventListener(q,D)}}).catch(function(){""===e?T():(t.classList.remove("dsqjs-disabled"),t.innerHTML="加载更多评论失败，点击重试",t.addEventListener(q,i))})},u=function(e){function r(e){return e.comment.author.profileUrl?(e.comment.avatarEl='<a href="'+e.comment.author.profileUrl+'"><img src="'+n(e.comment.author.avatar.cache)+'" '+c+"></a>",e.comment.authorEl='<span class="dsqjs-post-author"><a href="'+e.comment.author.profileUrl+'" '+c+">"+e.comment.author.name+"</a></span>"):(e.comment.avatarEl='<img src="'+n(e.comment.author.avatar.cache)+'">',e.comment.authorEl='<span class="dsqjs-post-author">'+e.comment.author.name+"</span>"),C.config.adminLabel&&e.isPrimary&&(e.comment.authorEl+='<span class="dsqjs-admin-badge">'+C.config.adminLabel+"</span>"),e}function a(e){console.log("begin render Post Item");var s="",o="",o=e.isDeleted?"<small>此评论已被删除</small>":(console.log("before removeDisqUs(replaceDisquscdn"),s=e.authorEl+'<span class="dsqjs-bullet"></span>',function(e){console.log("begin removeDisqUs, input= ",e);var s=f.createElement("div");s.innerHTML=e;var o=s.getElementsByTagName("a");return console.log("aTag: ",o),Array.from(o).forEach(function(e){console.log("before decodeURIComponent"),console.log("i = ",e," i.href = ",e.href);var s=decodeURIComponent(e.href.replace(/https:\/\/disq\.us\/url\?url=/g,"")).replace(/(.*):.+cuid=.*/,"$1");console.log("afther decodeURIComponent"),e.href=s,e.innerHTML=s,e.rel="external noopener nofollow noreferrer",e.target="_blank"}),console.log("before return from removeDisqUs"),s.innerHTML}(n(e.message)));return console.log("before ret from renderPostItem"),j(e,s,o)}var n=function(e){return e.replace(/a\.disquscdn\.com/g,"c.disquscdn.com")},o="";s(e).map(function(e){console.log("before check child comment"),e.children&&(e.nesting=1),console.log("before processData"),e=r(e),console.log("end processData");var s="";e.hasMore&&(s='<p class="dsqjs-has-more">切换至 <a id="load-more-'+e.comment.id+'">完整 Disqus 模式</a> 显示更多回复</p>'),console.log("before render Post Item"),o+='<li data-id="comment-'+e.comment.id+'" id="comment-'+e.comment.id+'">'+a(e.comment)+function o(e){console.log("begin childrenComments");var n=e.nesting,s=e.children||[];if(s){var t="",t=n<C.config.nesting?'<ul class="dsqjs-post-list dsqjs-children">':'<ul class="dsqjs-post-list">';return console.log("before children.map"),s.map(function(e){(e=r(e)).nesting=n+1;var s=e.hasMore?'<p class="dsqjs-has-more">切换至 <a class="dsqjs-has-more-btn" id="load-more-'+e.comment.id+'" data-more-id="comment-'+e.comment.id+'">完整 Disqus 模式</a> 显示更多回复</p>':"";t+='<li data-id="comment-'+e.comment.id+'" id="comment-'+e.comment.id+'">'+a(e.comment)+o(e)+s+"</li>"}),t+="</ul>",console.log("before return from childrenComments"),0!==t.length?t:void 0}}(e)+s+"</li>",console.log("end renderPost Item")}),console.log("end whole parseComment"),g("你可能无法访问 Disqus，已启用评论基础模式。"+v),console.log("before set innerHTML"),p("dsqjs-post-container").innerHTML=o,console.log("before assignClickEventForAskForFulButton"),L(),console.log("before return from renderComment ")}}function T(e){console.log(e),g('评论基础模式加载失败，是否 <a id="dsqjs-reload-dsqjs" class="dsqjs-msg-btn">重载</a> 或 <a id="dsqjs-reload-disqus" class="dsqjs-msg-btn">尝试完整 Disqus 模式</a> ？'),p("dsqjs-reload-dsqjs").addEventListener(q,i),p("dsqjs-reload-disqus").addEventListener(q,y)}function D(){E("dsqjs_mode","dsqjs"),i()}function w(){E("dsqjs_mode","disqus"),e()}var C={},u=f.location.origin+f.location.pathname+f.location.search;C.config=t({api:"https://disqus.skk.moe/disqus/",identifier:u,url:u,title:f.title,siteName:"",nesting:parseInt(U.nesting)||4,nocomment:"这里冷冷清清的，一条评论都没有"},U),C.page={};var I=C.config.apikey,M=function(){return Array.isArray(I)?I[Math.floor(Math.random()*I.length)]:I};s.disqus_config=function(){this.page.url=C.config.url,this.page.identifier=C.config.identifier,this.page.title=C.config.title},p(d).innerHTML='<div id="dsqjs"><div id="dsqjs-msg"></div>'+l+"</div>",n&&o&&r?(C.mode=o.getItem("dsqjs_mode"),C.sortType=o.getItem(h)||o.getItem("disqus.sort"),C.sortType||(E(h,"desc"),C.sortType="desc"),("disqus"===C.mode?e:"dsqjs"===C.mode?i:y)()):(g("你的浏览器版本过低，不兼容评论基础模式。"+v),L())}(window,document,localStorage,fetch,Promise)}try{module.exports=DisqusJS}catch(e){}